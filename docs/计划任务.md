# macOS 计划任务 (launchd)

macOS 推荐使用 launchd 替代 cron 来管理计划任务.

## 配置文件

创建 plist 文件: `~/Library/LaunchAgents/com.user.cursor-agent.plist`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Label</key>
    <string>com.user.cursor-agent</string>
    <key>ProgramArguments</key>
    <array>
        <string>/bin/bash</string>
        <string>-c</string>
        <string>/Users/a/.local/bin/cursor-agent -p "$(date)" --print -f --output-format text</string>
    </array>
    <key>StartInterval</key>
    <integer>600</integer>
    <key>WorkingDirectory</key>
    <string>/Users/a/Downloads/trader</string>
    <key>StandardOutPath</key>
    <string>/tmp/cursor-agent.log</string>
    <key>StandardErrorPath</key>
    <string>/tmp/cursor-agent.error.log</string>
</dict>
</plist>
```

## 常用命令

```bash
# 加载任务 (启用)
launchctl load ~/Library/LaunchAgents/com.user.cursor-agent.plist

# 卸载任务 (停用)
launchctl unload ~/Library/LaunchAgents/com.user.cursor-agent.plist

# 立即运行一次 (测试)
launchctl start com.user.cursor-agent

# 查看任务状态
launchctl list | grep cursor-agent

# 查看日志
tail -f /tmp/cursor-agent.log
tail -f /tmp/cursor-agent.error.log
```

## 配置说明

| 字段 | 说明 |
|------|------|
| `Label` | 任务唯一标识 |
| `ProgramArguments` | 执行的命令 |
| `StartInterval` | 执行间隔 (秒), 600 = 10分钟 |
| `StandardOutPath` | 标准输出日志路径 |
| `StandardErrorPath` | 错误输出日志路径 |

## 其他常用配置项

```xml
<!-- 指定时间执行 (类似 cron) -->
<key>StartCalendarInterval</key>
<dict>
    <key>Hour</key>
    <integer>9</integer>
    <key>Minute</key>
    <integer>0</integer>
</dict>

<!-- 开机自动启动 -->
<key>RunAtLoad</key>
<true/>

<!-- 设置工作目录 -->
<key>WorkingDirectory</key>
<string>/Users/a/Downloads/trader</string>

<!-- 设置环境变量 -->
<key>EnvironmentVariables</key>
<dict>
    <key>PATH</key>
    <string>/usr/local/bin:/usr/bin:/bin:/Users/a/.local/bin</string>
</dict>
```

