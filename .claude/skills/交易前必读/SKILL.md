---
name: pre-trading-checklist
description: 每次对话必读的行为规范 - 定义 AI 代理在收到不同类型消息时的行为, 以及交易前的检查流程
triggers:
  - 每次对话开始时
  - 收到时间/空白消息时
---

# 交易前必读

## 概述

此 skill 定义 AI 代理在每次对话开始时的**行为规范**, 包括:

1. 如何解读交易员的消息
2. 收到不同类型消息时的处理流程
3. 交易前必须检查的事项

## 核心风控规则

**必须阅读 `docs/交易前必读.md`**, 其中包含:

1. **账户杠杆限制** - 整体杠杆不超过 10 倍, 超过立即平仓
2. **过夜持仓规则** - 过夜不持仓, 收盘前赚钱就平仓
3. **交易时段** - 07:00-24:00 CST 可开仓

---

## 消息类型识别

### 类型 1: 时间/空白消息 (执行检查)

当交易员发送以下内容时, 视为**执行检查指令**:

- 空白消息 / 空格
- 仅包含时间 (如 "16:30", "2025-12-20 16:30")
- 仅包含 "?" 或 "check"
- 仅包含 "状态" / "检查" / "情况"

**处理流程:**

按照 [检查流程](#检查流程-每次对话) 执行:

1. 读取 `docs/最新指令.md`
2. 获取当前时间 (使用 MCP time-tools)
3. 检查当前持仓状态 (使用 MCP binance-futures)
4. 根据最新指令和持仓情况处理:
   - **有执行中指令** → 按指令规则检查是否满足操作条件
   - **无执行中指令但有持仓** → 结合核心风控规则判断是否需要操作
   - **无指令无持仓** → 汇报账户状态
5. 汇报当前状态和建议操作

### 类型 2: 具体指令 (新任务)

当交易员发送具体交易指令时:

- "今天不要做空"
- "BOLL 顶部做空底部做多"
- "帮我平仓"

**处理流程:**

1. 解析指令类型 (禁令/一次性/周期性)
2. 追问不明确的细节
3. 更新 `docs/最新指令.md`
4. 确认已记录

### 类型 3: 普通对话

当交易员发送问题或讨论时:

- "BTC 现在什么情况?"
- "分析一下 ETH 的走势"
- "帮我看看持仓"

**处理流程:**

正常回答, 但仍需遵守全局禁令和交易时段限制

---

## 检查流程 (每次对话)

```
开始对话
    │
    ▼
┌─────────────────────┐
│ 1. 读取最新指令      │  docs/最新指令.md
└─────────────────────┘
    │
    ▼
┌─────────────────────┐
│ 2. 检查全局禁令      │  是否有生效中的禁令?
└─────────────────────┘
    │
    ▼
┌─────────────────────┐
│ 3. 检查交易时段      │  当前是否可开仓? (07:00-24:00)
└─────────────────────┘
    │
    ▼
┌─────────────────────┐
│ 4. 检查当前持仓      │  有持仓? 盈亏多少?
└─────────────────────┘
    │
    ▼
┌─────────────────────┐
│ 5. 根据消息类型处理   │
└─────────────────────┘
```

---

## 持仓检查要点

当有持仓时, 必须检查:

| 检查项 | 说明 |
|-------|------|
| 持仓方向 | 多/空 |
| 入场价格 | 开仓均价 |
| 当前价格 | 实时价格 |
| 浮动盈亏 | 当前盈亏金额和百分比 |
| 持仓时间 | 开仓到现在多久了 |
| 止损止盈 | 是否设置? 距离多远? |

### 无执行中指令时的持仓处理

当没有执行中的指令但有持仓时, 结合**核心风控规则**判断:

1. 检查是否触发风控规则 (杠杆超限、过夜持仓等)
2. 汇报持仓状态和盈亏情况
3. 根据风控规则给出建议操作
4. 询问交易员确认

### 有执行中指令时的持仓处理

示例: 最新指令要求"顶底震荡顶部做空底部做多"

- 如果**顶部做空已开仓**, 收到时间消息时:
  - 检查当前价格位置 (是否到达中轨/底部?)
  - 检查浮盈情况 (是否满足止盈条件?)
  - 检查持仓时间 (是否需要提醒交易员?)
  - 给出建议: 继续持有 / 可以止盈 / 建议平仓

---

## 汇报格式

### 时间/空白消息的回复模板

```markdown
## 当前状态

**时间**: 2025-12-20 16:30 CST (周六)
**交易时段**: 可交易 (距收盘 7.5 小时)

### 全局禁令
- 过夜不持仓, 收盘前赚钱就平仓 (永久生效)

### 当前持仓
| 币种 | 方向 | 入场价 | 当前价 | 盈亏 | 持仓时间 |
|-----|------|-------|-------|------|---------|
| BTC | 空 | 100,000 | 99,500 | +50 USDT (+0.5%) | 2 小时 |

### 执行中任务
- C001: BOLL 顶底交易 (周期性)
  - 当前状态: 顶部做空已入场, 等待止盈

### 建议操作
价格已回落 0.5%, 接近 BOLL 中轨, 可考虑:
1. 继续持有等待底部
2. 现在止盈落袋为安

是否平仓?
```

---

## 优先级顺序

1. **全局禁令** - 最高优先级, 违反禁令的操作直接拒绝
2. **交易时段** - 非交易时段禁止开仓
3. **过夜持仓规则** - 收盘前检查是否需要平仓
4. **执行中任务** - 按任务规则操作
5. **待执行任务** - 检查触发条件

---

## 注意事项

1. **时间/空白消息 = 执行检查**, 按检查流程汇报状态
2. **有持仓时重点关注盈亏**, 结合最新指令和风控规则判断
3. **不确定时询问交易员**, 不要擅自做决定
4. **所有交易操作需确认**, 除非指令明确授权自动执行

